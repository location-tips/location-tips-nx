ARG IMG_FROM

# Base image
FROM ${IMG_FROM} AS dependencies

ARG GOOGLE_MAPS_API_KEY
ARG GOOGLE_MAPS_ID
ARG DOMAIN
ARG FIREBASE_API_KEY
ARG FIREBASE_AUTH_DOMAIN
ARG FIREBASE_PROJECT_ID
ARG FIREBASE_STORAGE_BUCKET
ARG FIREBASE_MESSAGING_SENDER_ID
ARG FIREBASE_APP_ID

ENV GOOGLE_MAPS_API_KEY=${GOOGLE_MAPS_API_KEY}
ENV GOOGLE_MAPS_ID=${GOOGLE_MAPS_ID}
ENV DOMAIN=${DOMAIN}
ENV FIREBASE_API_KEY=${FIREBASE_API_KEY}
ENV FIREBASE_AUTH_DOMAIN=${FIREBASE_AUTH_DOMAIN}
ENV FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
ENV FIREBASE_STORAGE_BUCKET=${FIREBASE_STORAGE_BUCKET}
ENV FIREBASE_MESSAGING_SENDER_ID=${FIREBASE_MESSAGING_SENDER_ID}
ENV FIREBASE_APP_ID=${FIREBASE_APP_ID}

# Create app directory
WORKDIR /usr/src/app

COPY . .

# Creates a "dist" folder with the production build
# RUN nx run backend:build
RUN nx run frontend:build

EXPOSE 3000
EXPOSE 8080

# Start the server using the production build
CMD [ "npx", "next", "start", "./dist/frontend" ]
